<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>สมุดอวยพรออนไลน์</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body class="container py-5">

  <h1 class="mb-4 text-center">สมุดอวยพรออนไลน์</h1>

  <div class="mb-3">
    <input type="text" class="form-control" id="name" placeholder="ชื่อของคุณ">
  </div>
  <div class="mb-3">
    <textarea class="form-control" id="message" placeholder="ข้อความอวยพร" rows="3"></textarea>
  </div>
  <div class="mb-3 text-center">
    <button class="btn btn-primary" onclick="submitWish()">ส่งข้อความ</button>
  </div>

  <hr>

  <h2 class="text-center my-4">ข้อความอวยพรทั้งหมด</h2>
  <div id="wish-list" class="list-group"></div>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbzS1DFFmuchGo8Wd17pSmdeUuDsZeJNjKPnNGxYD1I7AbfhODK-gjHaWChZb9CkeQSa/exec";

    function loadWishes() {
      axios.get(`${API_URL}?action=read`)
        .then(response => {
          const wishes = response.data;
          const wishList = document.getElementById('wish-list');
          wishList.innerHTML = '';

          wishes.forEach(wish => {
            const item = document.createElement('div');
            item.className = "list-group-item";
            item.innerHTML = `<strong>${wish.name}</strong> : ${wish.message} <br><small>${new Date(wish.timestamp).toLocaleString()}</small>`;
            wishList.appendChild(item);
          });
        })
        .catch(error => console.error('Error loading wishes:', error));
    }

    function submitWish() {
      const name = document.getElementById('name').value.trim();
      const message = document.getElementById('message').value.trim();

      if (!name || !message) {
        alert("กรุณากรอกชื่อและข้อความให้ครบถ้วน");
        return;
      }

      axios.post(API_URL, {
        action: "add",
        name: name,
        message: message
      })
      .then(response => {
        document.getElementById('name').value = '';
        document.getElementById('message').value = '';
        loadWishes();
      })
      .catch(error => console.error('Error submitting wish:', error));
    }

    window.onload = loadWishes;
  </script>

</body>
</html>
